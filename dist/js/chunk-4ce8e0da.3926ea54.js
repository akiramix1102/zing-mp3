(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4ce8e0da"],{"069e":function(t,e,a){"use strict";a("101f")},"101f":function(t,e,a){},"1aae":function(t,e,a){},"3bc5":function(t,e,a){},8270:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"import-page"},[a("div",{staticClass:"be-flex main-action"},[a("div",{staticClass:"main-action__left"},[a("import-filter",{on:{search:t.handleSearch,filterDate:t.handleFilterDate,filterStatus:t.handleFilterStatus,filterUser:t.handleFilterUser}})],1),a("div",{staticStyle:{display:"flex"}},[a("el-button",{staticClass:"custom-button",staticStyle:{"margin-right":"10px"},attrs:{loading:t.isLoadingButton},on:{click:t.handleOpenExportFile}},[a("span",{staticClass:"be-inline-flex align-center"},[a("base-icon",{staticClass:"icon",attrs:{icon:"excel-fullcolor"}}),t._v(" Tải file mẫu ")],1)]),a("button",{staticClass:"cursor btn_upload",on:{click:t.UploadFileMonth}},[t._v("Upload file")])],1)]),a("div",{staticClass:"import-table"},[a("base-table",{attrs:{data:t.data,table:t.query,paginationInfo:"file","is-loading":t.isLoading,emptyText:"Không có dữ liệu cập nhật"},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange,rowClick:t.handleGetDetail}},[a("el-table-column",{attrs:{index:t.getIndex,type:"index",label:"#",width:"80",align:"center"}}),a("el-table-column",{attrs:{prop:"fileName",label:"TÊN"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",[t._v(t._s(e.row.fileName))]),e.row.size?a("span",{staticClass:"small"},[t._v(t._s(t._f("bytesToSize")(e.row.size)))]):t._e()]}}])}),a("el-table-column",{attrs:{prop:"peopleUpload",label:"NGƯỜI TẢI LÊN",width:"280"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"flex wrap-name"},[a("div",{staticClass:"flex-item-avatar"},[a("base-avatar",{attrs:{url:e.row.avatar,size:"xs"}})],1),a("div",{staticClass:"flex-item-name"},[t._v(" "+t._s(e.row.userName)),a("br"),a("span",{staticClass:"small"},[t._v(" "+t._s(e.row.userCode))])])])]}}])}),a("el-table-column",{attrs:{prop:"date_time",label:"NGÀY GIỜ",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("formatDateHour")(e.row.createdAt)))])]}}])}),a("el-table-column",{attrs:{prop:"status",label:"TRẠNG THÁI",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return["IN_PROGRESS"===e.row.status||"NEW"===e.row.status||"SUCCESS"===e.row.status?a("span",{staticClass:"status processing"},[t._v("Đang xử lý")]):t._e(),"FAIL"===e.row.status?a("span",{staticClass:"status error_data"},[t._v("Lỗi dữ liệu")]):t._e(),"COMPLETED"===e.row.status?a("span",{staticClass:"status processed"},[t._v("Đã xử lý")]):t._e()]}}])})],1)],1),a("import-file-detail",{attrs:{"detail-file":t.detailFile,"is-error":t.isError}}),a("upload-file-month",{on:{apply:t.init}})],1)},n=[],s=a("f3f3"),l=a("c964"),r=a("276c"),o=a("e954"),c=a("920b"),u=a("92a6"),d=(a("96cf"),a("4de4"),a("ac1f"),a("841c"),a("a15b"),a("9ab4")),h=a("c178"),p=a("1b40"),f=a("9f48"),b=a("c56f"),m=a("08ba"),v=a("494c"),g=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("base-popup",{staticClass:"popup-file-detail",attrs:{id:"popup-detail-kpi-month",name:"detail-file-kpi-month",open:t.handleOpen,close:t.handleClose,width:"1240px",hiddenFooter:!0}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("Nội dung file")]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoadingPopup,expression:"isLoadingPopup"}],staticClass:"body-content"},[a("div",{staticClass:"body-content__header"},[a("div",{staticClass:"be-flex-column header-file-name"},[a("span",{staticClass:"file-name"},[t._v(t._s(t.fileName))]),a("div",{staticClass:"be-flex wrap-user-name"},[a("base-avatar",{attrs:{url:t.detailFile.avatar,size:"xs"}}),a("span",{staticClass:"user-name"},[t._v(t._s(t.detailFile.userName))]),a("span",{staticClass:"date-time"},[t._v(t._s(t._f("formatDateHour")(t.detailFile.createdAt)))])],1)])]),t.isError?t._e():a("div",{staticClass:"body-content__table body-content__table--error"},[a("base-table",{attrs:{data:t.data,table:t.query,isLoading:t.isLoading,paginationInfo:"dòng"},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange}},[a("el-table-column",{attrs:{index:t.getIndex,type:"index",label:"#",width:"80",align:"center"}}),a("el-table-column",{attrs:{label:"MÃ ĐVKD",width:"90",align:"center",prop:"branchCode"}}),a("el-table-column",{attrs:{label:"PHÒNG/BAN",prop:"transactionCode",align:"left",width:"280px"}}),a("el-table-column",{attrs:{label:"TỔ",prop:"group",align:"left",width:"280px"}}),a("el-table-column",{attrs:{label:"CHỨC DANH",prop:"title",align:"left",width:"280px"}}),a("el-table-column",{attrs:{label:"MÃ CBNV",width:"120",prop:"memberCode",align:"center"}}),a("el-table-column",{attrs:{label:"TÊN CBNV",prop:"memberName",align:"left",width:"210px"}}),a("el-table-column",{attrs:{label:"CT_DOANH SỐ",prop:"salesProgram",width:"120px",align:"right"}})],1)],1),t.isError?a("div",{staticClass:"body-content__content body-content__content--error"},[a("div",{staticClass:"text-column"},[a("div",{staticClass:"be-flex text-item"},[a("span",{staticClass:"text-item__title"},[t._v("Số dòng lỗi format")]),a("span",{staticClass:"text-item__number text-bold"},[t._v(t._s(t.errorCount))])])])]):t._e(),t.isError?a("div",{staticClass:"body-content__table body-content__table--error"},[a("base-table",{attrs:{data:t.dataError,table:t.query,isLoading:t.isLoading,paginationInfo:"dòng"},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange}},[a("el-table-column",{attrs:{index:t.getIndex,type:"index",label:"#",width:"80",align:"center"}}),a("el-table-column",{attrs:{label:"stt dòng",width:"90",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.rowIndex)+" ")]}}],null,!1,3765580137)}),a("el-table-column",{attrs:{width:"20"}}),a("el-table-column",{attrs:{label:"mô tả lỗi"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.description)+" ")]}}],null,!1,1461819547)})],1)],1):t._e()])])},_=[],C=(a("b0c0"),a("2ef0")),y=a("6d3f"),O=a("ef28"),w=a("81f4"),x=a("385e"),k=a("d599"),I=a("37ef"),j=a("22d2"),N=a("46e4"),S=a("a77c"),T=a("65e2"),F=Object(m["a"])("import"),E=function(t){Object(c["a"])(a,t);var e=Object(u["a"])(a);function a(){var t;return Object(r["a"])(this,a),t=e.apply(this,arguments),t.data=[],t.detail={},t.tabs=[{id:0,name:"TỔNG HỢP LỖI",active:!0},{id:1,name:"sheet1"},{id:2,name:"PHI_PHAT_SINH"},{id:3,name:"HD_MOI"},{id:4,name:"HD_HUY"},{id:5,name:"HD_TAI_TUC"},{id:6,name:"HO_SO_PENDING"},{id:7,name:"HO_SO_TU_CHOI"},{id:8,name:"HD_MAT_HIEU_LUC"},{id:9,name:"DS_NHAC_THU_PHI_TAI_TUC"}],t.errorRow=[],t.dataError=[],t.totalErrorCount=0,t.sheetAactive="KPI_CBNV",t.isLoading=!1,t.isLoadingPopup=!1,t.query={page:1,limit:20,total:0},t}return Object(o["a"])(a,[{key:"getIndex",get:function(){return this.query.limit*(this.query.page-1)+1}},{key:"fileName",get:function(){return this.detailFile&&this.detailFile.fileName?this.detailFile.fileName.replaceAll(".xlsx"," "):""}},{key:"errorCount",get:function(){var t=this,e=Object(C["filter"])(this.errorRow,(function(e){return e.sheetName===t.sheetAactive}));return e.length?e[0].errorCount:!e.length&&this.sheetAactive?0:this.totalErrorCount}},{key:"handleOpen",value:function(){var t=this;this.isError?this.getSheetsName().then((function(){t.init()})):this.isError?this.tabs[0].active=!1:(this.tabs.shift(),this.tabs[0].active=!0,this.init())}},{key:"getSheetsName",value:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(){var e,a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={fileId:this.detailFile.id},t.next=3,F.getSheetsName(this.districtId,e).then((function(t){a.errorRow=t.data.data,a.tabs[0].active=!0,a.tabs[0].subactive=!0,a.tabs[1].active=!1,a.sheetAactive=null,Object(C["forEach"])(a.tabs,(function(e){Object(C["forEach"])(t.data.data,(function(t){e.name===t.sheetName&&(e.subactive=!0)}))}))}));case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"init",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e?this.isLoading=!0:this.isLoadingPopup=!0;var a=Object(s["a"])(Object(s["a"])({},this.query),{},{total:null,fileId:this.detailFile.id,sheetName:this.sheetAactive});F.getDetail(this.districtId,this.isError,a).then((function(a){t.isError?(t.dataError=a.list,t.totalErrorCount=a.total,t.query.total=t.errorCount):(t.detail=a.total,t.data=a.list,t.query.total=a.total.numOfRow),e?t.isLoading=!1:t.isLoadingPopup=!1})).catch((function(a){e?t.isLoading=!1:t.isLoadingPopup=!1,t.$message.error(a.message)}))}},{key:"handleClose",value:function(){this.isError||this.tabs.unshift({id:0,name:"Tổng hợp lỗi",active:!0}),this.detail={},this.dataError=[],this.errorRow=[],this.sheetAactive="KPI_CBNV",Object(C["forEach"])(this.tabs,(function(t){1===t.id?t.active=!0:(delete t.active,delete t.subactive)}))}},{key:"handleSizeChange",value:function(t){this.query.limit=t,this.init(!0)}},{key:"handleCurrentChange",value:function(t){this.query.page=t,this.init(!0)}}]),a}(Object(p["b"])(f["a"],b["a"]));Object(d["a"])([Object(p["c"])({required:!1,type:Object,default:{}})],E.prototype,"detailFile",void 0),Object(d["a"])([Object(p["c"])({required:!1,type:Boolean,default:!1})],E.prototype,"isError",void 0),E=Object(d["a"])([Object(p["a"])({components:{BaseTable:O["a"],BaseIcon:y["a"],HdTable:w["a"],HsTable:x["a"],PendingTable:k["a"],RejectTable:I["a"],InactiveTable:j["a"],ReminderTable:N["a"],IncurredTable:S["a"],TaiTucTable:T["a"]}})],E);var L=E,H=L,P=(a("a1c3"),a("2877")),A=Object(P["a"])(H,g,_,!1,null,"4bd67e52",null),D=A.exports,q=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("base-popup",{staticClass:"upload-file-month",attrs:{name:"upload-file-month",width:"386px",hiddenFooter:!0,close:t.handleClose}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("Chọn thời gian")]),a("div",{staticClass:"content"},[a("div",[a("div",{staticClass:"content-left"},[a("div",{staticClass:"title"},[a("span",[t._v("Tháng")])]),a("el-select",{attrs:{placeholder:"Tháng",size:"small"},model:{value:t.valueMonth,callback:function(e){t.valueMonth=e},expression:"valueMonth"}},t._l(12,(function(t){return a("el-option",{key:t,attrs:{label:"Tháng "+t,value:t}})})),1)],1),a("div",{staticClass:"content-right"},[a("div",{staticClass:"title"},[a("span",[t._v("Năm")])]),a("el-date-picker",{attrs:{size:"small",type:"year","value-format":"yyyy",placeholder:"Năm",width:"160px!important",clearable:!1},model:{value:t.valueYear,callback:function(e){t.valueYear=e},expression:"valueYear"}})],1)])]),a("div",{staticClass:"bottom"},[a("button",{staticClass:"btn-close",on:{click:t.handleClose}},[t._v("Huỷ")]),a("el-upload",{staticClass:"upload-demo",attrs:{action:"","auto-upload":!1,accept:t._f("joinArray")(t.fileAccept),"show-file-list":!1,"on-change":t.handleChangeFile}},[a("button",{staticClass:"btn-upload",on:{click:t.handleChangeFile}},[t._v("Upload file")])])],1)])},U=[],R=Object(m["a"])("import"),M=function(t){Object(c["a"])(a,t);var e=Object(u["a"])(a);function a(){var t;return Object(r["a"])(this,a),t=e.apply(this,arguments),t.valueMonth=(new Date).getMonth()+1,t.valueYear=(new Date).getFullYear()+"",t.fileAccept=h["a"],t}return Object(o["a"])(a,[{key:"handleClose",value:function(){this.setOpenPopup({popupName:"upload-file-month",isOpen:!1})}},{key:"handleChangeFile",value:function(t){this.uploadFile(t)}},{key:"uploadFile",value:function(t){var e=this,a=new FormData;"ready"===t.status&&(a.append("file",t.raw),a.append("name",t.name),a.append("type","KPI_MONTH"),a.append("month","".concat(this.valueMonth)),a.append("year",this.valueYear),this.$message.success("Đang tải file lên"),R.uploadFile(this.districtId,a).then((function(){e.$message.success("Tải lên thành công"),e.handleClose(),e.$emit("apply")})).catch((function(t){429===t.errorCode?(e.$message.error("Không upload được file khi hệ thống đang cập nhật dữ liệu. Vui lòng thử lại sau ít phút"),e.handleClose()):(e.$message.error("Tải lên thất bại"),e.handleClose())})))}}]),a}(Object(p["b"])(f["a"]));M=Object(d["a"])([Object(p["a"])({components:{}})],M);var z=M,B=z,G=(a("9bdc"),Object(P["a"])(B,q,U,!1,null,"db6288a2",null)),$=G.exports,K=a("4bb5"),Y=Object(K["a"])("beUser"),V=Object(m["a"])("import"),Q=function(t){Object(c["a"])(a,t);var e=Object(u["a"])(a);function a(){var t;return Object(r["a"])(this,a),t=e.apply(this,arguments),t.data=[],t.isLoadingButton=!1,t.query={page:1,limit:20,total:0},t.filter={search:"",fd:"",td:"",status:"",userIds:""},t.detailFile={},t.isError=!1,t.isLoading=!1,t.isSpace=!1,t.fileAccept=h["a"],t.params={type:"KPI_MONTH"},t}return Object(o["a"])(a,[{key:"mounted",value:function(){this.init()}},{key:"getIndex",get:function(){return this.query.limit*(this.query.page-1)+1}},{key:"init",value:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.isLoading=!0,e=Object(s["a"])(Object(s["a"])({},this.query),{},{search:this.filter.search?this.filter.search:null,fd:this.filter.fd?this.filter.fd:null,td:this.filter.td?this.filter.td:null,status:this.filter.status?this.filter.status:null,userIds:this.filter.userIds?this.filter.userIds:null,total:null,type:"KPI_MONTH"}),t.next=4,V.getData(this.districtId,e);case 4:a=t.sent,this.data=a.files,this.query.total=a.total,this.isLoading=!1;case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"handleSearch",value:function(t){this.resetQuery(),this.isLoading||(this.filter.search=Object(C["trim"])(t),this.init())}},{key:"handleFilterDate",value:function(t){this.resetQuery(),this.filter.fd=t.fd,this.filter.td=t.td,this.init()}},{key:"handleFilterStatus",value:function(t){this.resetQuery(),this.filter.status=t.join(","),this.init()}},{key:"handleFilterUser",value:function(t){this.resetQuery(),this.filter.userIds=t.join(","),this.init()}},{key:"handleSizeChange",value:function(t){this.query.limit=t,this.init()}},{key:"handleCurrentChange",value:function(t){this.query.page=t,this.init()}},{key:"handleGetDetail",value:function(t){this.detailFile=t.row,this.isError="FAIL"===t.row.status,"IN_PROGRESS"!==t.row.status&&"NEW"!==t.row.status&&"SUCCESS"!==t.row.status?this.setOpenPopup({popupName:"detail-file-kpi-month",isOpen:!0}):this.$message.error("File đang xử lý, vui lòng đợi")}},{key:"resetQuery",value:function(){this.query.page=1,this.query.limit=20}},{key:"hasWhiteSpace",value:function(t){t.indexOf(" ")>=0&&(this.isSpace=!0)}},{key:"UploadFileMonth",value:function(){this.setOpenPopup({popupName:"upload-file-month",isOpen:!0})}},{key:"created",value:function(){var t,e;this.apiImport=Object(m["a"])("import",{districtId:null===(t=this.user)||void 0===t||null===(e=t.districts)||void 0===e?void 0:e[0].id})}},{key:"handleOpenExportFile",value:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(){var e,a,i=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.isLoadingButton=!0,t.next=3,null===(e=this.apiImport)||void 0===e?void 0:e.spamleFile(this.districtId,this.params).then((function(t){a=t.data;var e=document.createElement("a");e.style.display="none",e.href=a,document.body.appendChild(e),e.click(),document.body.removeChild(e),i.isLoadingButton=!1,i.isLoadingButton=!1})).catch((function(t){console.log(t),i.isLoadingButton=!1}));case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}]),a}(Object(p["b"])(f["a"],b["a"]));Object(d["a"])([Y.State("user")],Q.prototype,"user",void 0),Q=Object(d["a"])([Object(p["a"])({components:{ImportFilter:v["a"],ImportFileDetail:D,UploadFileMonth:$}})],Q);var W=Q,J=W,X=(a("069e"),Object(P["a"])(J,i,n,!1,null,"5002fe18",null));e["default"]=X.exports},"9bdc":function(t,e,a){"use strict";a("3bc5")},a1c3:function(t,e,a){"use strict";a("1aae")}}]);
//# sourceMappingURL=chunk-4ce8e0da.3926ea54.js.map