(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a854ef32"],{"01d5":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"draggable"},[a("div",{class:e.classHeader},[e.firstColumn||e.borderHeader?e._e():a("div",{staticClass:"stripe"}),a("div",{staticClass:"content"},[a("h3",[e._v(e._s(e.dataProp.name?e.dataProp.name:""))]),a("div",{staticClass:"flex"},[a("span",{staticClass:"price"},[e._v(e._s(e._f("formatNumber")(e.dataProp.totalValue)))]),a("span",{staticClass:"dot"}),a("span",{staticClass:"count"},[e._v(e._s(e._f("formatNumber")(e.dataProp.numOfSalesDeal))+" cơ hội")])])])]),a("draggable",{staticClass:"list-group",attrs:{list:e.dataProp.salesDeals,group:"people"},on:{change:e.change},nativeOn:{scroll:function(t){return function(t){return e.handleScroll(t,e.dataProp.id)}.apply(null,arguments)}}},[e._l(e.dataProp.salesDeals,(function(t){return a("div",{key:t.id,staticClass:"list-group-item cursor",on:{click:function(a){return e.handleItemClick(t)}}},[a("div",{staticClass:"be-flex jc-space-between"},[a("h3",[e._v(e._s(t.name?t.name:""))]),a("el-popover",{attrs:{placement:"bottom","popper-class":"popper-action-deal"},on:{hide:e.hideAction},nativeOn:{click:function(t){return e.handleConflictClick.apply(null,arguments)}}},[a("div",{staticClass:"be-flex-column content"},[a("div",{staticClass:"content-item cursor",on:{click:function(a){return e.handleClickOpenAction({status:"edit",id:t.id})}}},[a("span",[e._v("Sửa thông tin")])]),a("div",{staticClass:"content-item cursor",on:{click:function(a){return e.handleClickOpenAction({status:"assign",id:t.id,data:t})}}},[a("span",[e._v("Gán phụ trách")])]),a("div",{staticClass:"content-item cursor",on:{click:function(a){return e.handleOpenPopupNote(t)}}},[a("span",[e._v("Ghi chú")])]),a("div",{staticClass:"content-item cursor",on:{click:function(a){return e.handleClickOpenAction({status:"createCalen",id:t.customerId,data:t})}}},[a("span",[e._v("Tạo lịch hẹn")])]),a("div",{staticClass:"content-item cursor",on:{click:function(a){return e.handleClickOpenAction({status:"uploadFile",id:t.id})}}},[a("span",[e._v("Upload tài liệu")])]),a("div",{staticClass:"content-item cursor",on:{click:function(a){return e.handleClickOpenAction({status:"delete",id:t.id})}}},[a("span",[e._v("Xóa cơ hội")])])]),a("div",{staticClass:"reference",attrs:{slot:"reference"},slot:"reference"},[a("i",{staticClass:"el-icon-more"})])])],1),a("p",{staticClass:"small"},[e._v(e._s(t.salesFullName?t.salesFullName:""))]),a("span",{staticClass:"flex"},[t.id&&t.salesAvatar?a("el-avatar",{attrs:{src:t.salesAvatar,size:"small"}}):a("base-icon",{staticClass:"avatar__imployee--defalt",attrs:{icon:"icon-avatar-default"}}),a("span",{staticClass:"deal-value"},[e._v(e._s(e._f("formatNumber")(t.dealValue)))])],1)])})),e.firstColumn?a("el-button",{staticClass:"btn-add-deal",attrs:{slot:"footer",icon:"el-icon-plus"},on:{click:function(t){return e.handleClickOpenAction({status:"add",id:""})}},slot:"footer"},[e._v("Thêm cơ hội")]):e._e()],2)],1)},n=[],s=a("276c"),l=a("e954"),o=a("920b"),r=a("92a6"),c=a("9ab4"),d=a("2ef0"),p=a("1b40"),u=a("b76a"),h=a.n(u),f=a("c56f"),m=a("9f48"),v=function(e){Object(o["a"])(a,e);var t=Object(r["a"])(a);function a(){var e;return Object(s["a"])(this,a),e=t.apply(this,arguments),e.isLog=!1,e.dataPopup={title:"Thêm mới cơ hội bán hàng",code:"",id:"",data:{}},e.isConflictClick=!1,e.debounceLoadMore=Object(d["debounce"])(e.handleLoadMore,500),e}return Object(l["a"])(a,[{key:"classHeader",get:function(){return this.borderHeader&&!this.firstColumn?"flex draggable-header header-border-left":"flex draggable-header"}},{key:"handleScroll",value:function(e,t){e.target.scrollTop+e.target.offsetHeight+1>=e.target.scrollHeight&&this.debounceLoadMore(t)}},{key:"handleLoadMore",value:function(e){this.$emit("loadMore",e)}},{key:"hideAction",value:function(){this.isConflictClick=!1}},{key:"handleConflictClick",value:function(){this.isConflictClick=!0}},{key:"change",value:function(e){console.log(e),e["added"]&&(e["added"].id=this.dataProp.id),e["removed"]&&(e["removed"].id=this.dataProp.id),e["moved"]&&(e["moved"].id=this.dataProp.id),this.$emit("log",e)}},{key:"handleItemClick",value:function(e){this.isConflictClick||this.$emit("clickItem",e)}},{key:"handleClickOpenAction",value:function(e){this.$emit("action",e)}},{key:"handleOpenPopupNote",value:function(e){this.$emit("createNote",e)}}]),a}(Object(p["b"])(f["a"],m["a"]));Object(c["a"])([Object(p["c"])({type:Object})],v.prototype,"dataProp",void 0),Object(c["a"])([Object(p["c"])()],v.prototype,"firstColumn",void 0),Object(c["a"])([Object(p["c"])()],v.prototype,"borderHeader",void 0),v=Object(c["a"])([Object(p["a"])({components:{draggable:h.a}})],v);var b=v,g=b,C=(a("81a9"),a("2877")),O=Object(C["a"])(g,i,n,!1,null,"a686cdf4",null);t["a"]=O.exports},1522:function(e,t,a){},"181e":function(e,t,a){"use strict";a("1522")},"41fe":function(e,t,a){},"4f5c":function(e,t,a){},"57f9":function(e,t,a){"use strict";a("4f5c")},7461:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("base-popup",{staticClass:"addUploadFile",attrs:{name:"add-upload-file",open:e.handleOpen,close:e.handleClose,hiddenFooter:!0,width:"520px",top:"5vh"}},[a("div",{attrs:{slot:"title"},slot:"title"},[e._v("Thêm file tài liệu")]),a("el-upload",{staticClass:"upload body-Upload",attrs:{drag:"",":file-list":e.fileList,"on-change":e.handleChangeFile,"auto-upload":!1,"show-file-list":!1,action:"",multiple:""}},[a("div",{staticClass:"el-upload__text"},[e._v("Kéo thả file hoặc"),a("em",[e._v(" Chọn từ máy tính")])])]),e.fileList.length?a("div",{staticClass:"list-file"},e._l(e.fileList,(function(t){return a("div",{key:t.uid,staticClass:"flex jc-space-between file-item"},[a("div",{staticClass:"left"},[a("p",[e._v(e._s(t.name))])]),a("div",{staticClass:"right",on:{click:function(a){return e.handleDeleteFile(t.uid)}}},[a("base-icon",{staticClass:"icon-action cursor",attrs:{icon:"delete"}})],1)])})),0):e._e(),a("template",{slot:"footer"},[a("div",{staticClass:"bottom"},[a("div",{staticClass:"bt-top flex"},[a("div",{staticClass:"bt-center"},[a("el-button",{staticClass:"group-button-cencel",on:{click:e.handleClose}},[e._v("Hủy")]),e.fileList.length?a("el-button",{staticClass:"be-btn-danger group-button-save",on:{click:e.handleAddFile}},[e._v("Thêm")]):e._e()],1)])])])],2)},n=[],s=a("d0ff"),l=a("c964"),o=a("276c"),r=a("e954"),c=a("920b"),d=a("92a6"),p=(a("b0c0"),a("96cf"),a("9ab4")),u=a("9f48"),h=a("1b40"),f=a("4bb5"),m=a("08ba"),v=a("2ef0"),b=Object(f["a"])("beUser"),g=function(e){Object(c["a"])(a,e);var t=Object(d["a"])(a);function a(){var e;return Object(o["a"])(this,a),e=t.apply(this,arguments),e.fileList=[],e.dataInput={attachFiles:[]},e}return Object(r["a"])(a,[{key:"handleChangeFile",value:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,s,l,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=new FormData,"ready"!==t.status){e.next=16;break}return t.type=t.raw.type,this.fileList.push(t),a.append("files",t.raw),t.percentage=1,i=function(e){var a=e.loaded/e.total*100;t.percentage=a},n={},n.data=a,n.progress=i,s=t.uid,e.next=13,this.apiUpload.uploadFile(n);case 13:l=e.sent,o=Object(v["findIndex"])(this.fileList,(function(e){return e.uid===s})),this.fileList[o].url=l.success[0].url;case 16:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleDeleteFile",value:function(e){this.fileList=Object(v["filter"])(this.fileList,(function(t){return t.uid!==e}))}},{key:"handleAddFile",value:function(){var e,t,a=this;(this.fileList.length&&(this.dataInput.attachFiles=Object(s["a"])(this.fileList)),this.idUpload&&"customer"==this.$route.name||"customerNewsfeed"==this.$route.name)?null===(e=this.api)||void 0===e||e.uploadFile(this.idUpload,this.dataInput).then((function(e){a.$message.success("Upload file thành công"),a.fileList=[],a.$emit("load"),a.handleClose()})).catch((function(e){console.log(e)})):null===(t=this.api)||void 0===t||t.uploadFileDeal(this.idUploadDeal,this.dataInput).then((function(e){a.$message.success("Upload file thành công"),a.fileList=[],a.$emit("load"),a.handleClose()})).catch((function(e){console.log(e)}))}},{key:"handleOpen",value:function(){console.log("test id bên khách hàng",this.idUpload),console.log("test id dell",this.idUploadDeal),console.log("route",this.$route)}},{key:"handleClose",value:function(){this.fileList=[],this.setOpenPopup({popupName:"add-upload-file",isOpen:!1})}},{key:"created",value:function(){var e,t,a,i;this.apiUpload=Object(m["a"])("upload",{districtId:null===(e=this.user)||void 0===e||null===(t=e.districts)||void 0===t?void 0:t[0].id}),this.api=Object(m["a"])("category",{districtId:null===(a=this.user)||void 0===a||null===(i=a.districts)||void 0===i?void 0:i[0].id})}}]),a}(Object(h["b"])(u["a"]));Object(p["a"])([b.State("user")],g.prototype,"user",void 0),Object(p["a"])([Object(h["c"])()],g.prototype,"idUpload",void 0),Object(p["a"])([Object(h["c"])()],g.prototype,"idUploadDeal",void 0),g=Object(p["a"])([Object(h["a"])({components:{}})],g);var C=g,O=C,k=(a("181e"),a("2877")),y=Object(k["a"])(O,i,n,!1,null,null,null);t["a"]=y.exports},"81a9":function(e,t,a){"use strict";a("41fe")},e5c8:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"deal-page draggable-page"},[a("div",{staticClass:"header be-flex jc-space-between"},[a("deal-filter",{staticClass:"be-flex-item",attrs:{filters:e.filters,isPipeline:!1},on:{change:e.handleFiltersChange}}),a("div",{staticClass:"actions"},[a("el-select",{staticClass:"custom-button",attrs:{"popper-class":"popper-action-deal",size:"medium",placeholder:"Chọn Pipeline"},on:{change:e.handleChangPipeLine},model:{value:e.filters.pipelineId,callback:function(t){e.$set(e.filters,"pipelineId",t)},expression:"filters.pipelineId"}},[a("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:function(){return e.loadMore("pipeline")},expression:"() => loadMore('pipeline')"}],attrs:{"infinite-scroll-delay":"500"}},[e._l(e.listPipeline,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),a("el-option",{staticClass:"option-sticky",attrs:{label:"",value:e.filters.pipelineId},nativeOn:{click:function(t){return e.handleRedirect.apply(null,arguments)}}},[a("i",{staticClass:"el-icon-plus"}),e._v(" Thêm Pipeline")])],2)]),a("el-dropdown",{staticClass:"custom-button",attrs:{size:"medium","split-button":""},on:{click:function(t){return e.handleClickOpenAction({status:"add",id:""})}}},[e._v(" Thêm mới "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[e._v("Thêm mới từ Excel")])],1)],1),a("el-button",{staticClass:"custom-button",attrs:{loading:!1}},[a("span",{staticClass:"be-inline-flex align-center"},[a("base-icon",{staticClass:"icon",attrs:{icon:"excel-fullcolor"}}),e._v(" Xuất Excel ")],1)])],1)],1),Object.keys(e.dataDrag).length>0?a("div",{staticClass:"content"},[a("el-row",{staticClass:"be-flex"},e._l(e.dataDrag,(function(t,i,n){return a("el-col",{key:t.id,staticClass:"be-flex-item"},[a("draggable",{attrs:{dataProp:t,firstColumn:0==n,borderHeader:e.borderHeader},on:{createNote:e.handleOpenCreateNote,loadMore:e.loadMoreDrag,clickItem:e.handleClickItem,log:e.handleChangeItem,action:e.handleClickOpenAction}})],1)})),1)],1):e._e(),a("empty-block",{attrs:{show:Object.keys(e.dataDrag).length<=0,emptyText:"Không có dữ liệu cơ hội bán hàng"}}),a("create-deal",{attrs:{dataProp:e.dataPopup},on:{apply:e.init,openDestroy:e.handleClickOpenAction}}),a("popup-confirm-deal",{attrs:{dataProp:e.dataPopup},on:{confirm:e.handleConfirm}}),a("popup-note",{attrs:{type:e.type},on:{update:e.handleCreateNote}}),a("appoint-customer",{attrs:{dataRows:e.dataRow,idCustomer:e.idCustomer}}),a("popup-add-upload-file",{attrs:{idUploadDeal:e.idUploadDeal}})],1)},n=[],s=a("d0ff"),l=a("f3f3"),o=a("c964"),r=a("276c"),c=a("e954"),d=a("920b"),p=a("92a6"),u=(a("96cf"),a("b0c0"),a("99af"),a("d3b7"),a("ddb0"),a("4ec9"),a("3ca3"),a("d81d"),a("caad"),a("2532"),a("25f0"),a("9ab4")),h=a("1b40"),f=a("7fd9"),m=a("08ba"),v=a("c56f"),b=a("2ef0"),g=a("be17"),C=a("9f48"),O=a("01d5"),k=a("1572"),y=a("222c"),j=a("d67a"),D=a("4bb5"),P=a("0554"),_=a("7461"),w=Object(D["a"])("beDeal"),x=function(e){Object(d["a"])(a,e);var t=Object(p["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.listPipeline=[],e.isLoading=!1,e.filters={},e.dataPopup={title:"",code:"",id:"",data:{},dataSelect:[]},e.dataRow={data:{}},e.idCustomer="",e.idUploadDeal="",e.query={limit:10},e.queryLoadMorePipeline={page:1,limit:20},e.queryLoadMore={},e.dataDrag={},e.dealId=0,e.type="add",e.paramUpdateDrag={},e}return Object(c["a"])(a,[{key:"borderHeader",get:function(){return"forecast"==this.$route.name}},{key:"handleUpdateDrag",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var a,i,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(t["removed"]&&t["added"]||t["moved"])){e.next=9;break}return console.log("ada",t["moved"]),a={},i="",t["moved"]?(i=t["moved"].element.id,a={currentStageId:t["moved"]?t.moved.id:"",newStageId:t["moved"]?t.moved.id:"",position:t["moved"]?+t.moved.newIndex+1:""}):(i=t["removed"].element.id?t["removed"].element.id:t["added"].element.id,a={currentStageId:t["removed"]?t.removed.id:"",newStageId:t["added"]?t.added.id:"",position:t["added"]?+t.added.newIndex+1:""}),e.next=7,this.apiDeal.updateDrag(i,a).then((function(){return n.$message.success("Thay đổi vị trí thành công")})).catch((function(){n.$message.error("Thay đổi vị trí thất bại")}));case 7:this.paramUpdateDrag={},this.init();case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleChangeItem",value:function(e){this.paramUpdateDrag=Object(l["a"])(Object(l["a"])({},this.paramUpdateDrag),e)}},{key:"handleChangPipeLine",value:function(e){this.filters.pipelineId=+e,this.init()}},{key:"handleRedirect",value:function(){this.$router.push({name:"ProgressiveSales",params:{type:"them"}})}},{key:"handleClick",value:function(){this.setOpenPopup({popupName:"create-deal",isOpen:!0})}},{key:"handleOpenCreateNote",value:function(e){this.dealId=e.id,this.setOpenPopup({popupName:"popup-note",isOpen:!0})}},{key:"handleCreateNote",value:function(e){var t=this,a="DEAL";this.apiDeal.createNote(a,{description:e.content,dealId:this.dealId}).then((function(){t.$message.success("Tạo ghi chú thành công")}))}},{key:"loadMore",value:function(e){var t=this;switch(e){case"pipeline":this.queryLoadMorePipeline.limit+=10,this.apiDeal.getDataSalesPipelines(this.queryLoadMorePipeline).then((function(e){var a=[].concat(Object(s["a"])(t.listPipeline),Object(s["a"])(e.data.content));t.listPipeline=Object(s["a"])(new Map(a.map((function(e){return[e["id"],e]}))).values())}));break}}},{key:"handleClickOpenAction",value:function(e){var t=e.status,a=e.id;this.dataPopup.code=t,this.dataPopup.id=a,(t.includes("assign")||"delete"==t)&&(this.dataPopup.title="delete"==t?"Xác nhận xóa":"Gán Nhân viên phụ trách",this.dataPopup.data=null===e||void 0===e?void 0:e.data,this.setOpenPopup({popupName:"popup-confirm-deal",isOpen:!0})),"add"!=t&&"edit"!=t||(this.dataPopup.title="add"==t?"Thêm mới cơ hội bán hàng":"Sửa thông tin cơ hội bán hàng",this.setOpenPopup({popupName:"create-deal",isOpen:!0})),"createCalen"==t&&(this.idCustomer=a,this.dataRow=null===e||void 0===e?void 0:e.data,console.log("dac biet",this.dataRow),this.setOpenPopup({popupName:"appoint-customer",isOpen:!0})),"uploadFile"==t&&(this.idUploadDeal=a,this.setOpenPopup({popupName:"add-upload-file",isOpen:!0}))}},{key:"handleConfirm",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("delete"!=this.dataPopup.code){e.next=6;break}if(!this.dataPopup.id||0==this.dataPopup.id){e.next=4;break}return e.next=4,this.apiDeal.deleteDealOrCusById("sales-deals",Object(b["trim"])(this.dataPopup.id.toString())).then((function(){a.$message.success("Xóa thành công"),a.setOpenPopup({popupName:"popup-confirm-deal",isOpen:!1}),a.init()})).catch((function(e){return a.$message.error(e.message)}));case 4:e.next=8;break;case 6:return e.next=8,this.apiDeal.assignDeal("sales-deals",t).then((function(){a.$message.success("Gán thành công"),a.setOpenPopup({popupName:"popup-confirm-deal",isOpen:!1}),a.init()})).catch((function(e){return a.$message.error(e.message)}));case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"loadMoreDrag",value:function(e){var t=this;this.queryLoadMore[e].limit+=5,this.apiDeal.getDataBoard("sales-deals",Object(l["a"])(Object(l["a"])({},this.filters),this.queryLoadMore[e])).then((function(a){var i=[].concat(Object(s["a"])(t.dataDrag[e].salesDeals),Object(s["a"])(a[e].salesDeals));t.dataDrag[e].salesDeals=Object(s["a"])(new Map(i.map((function(e){return[e["id"],e]}))).values())}))}},{key:"handleClickItem",value:function(e){this.$router.push({name:"dealNewsfeed",params:{type:this.$route.params.type,view:"bang-tin",id:e.id}})}},{key:"handleFiltersChange",value:function(e){this.setDealFilter({dealName:this.$route.name,filters:e,data:e.dataChange||{}}),delete e.dataChange,this.filters=e,this.init()}},{key:"init",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.isLoading=!0,!(this.listPipeline.length<1)){e.next=4;break}return e.next=4,this.apiDeal.getDataSalesPipelines(this.queryLoadMorePipeline).then((function(e){a.listPipeline=e.data.content,a.filters.pipelineId||(a.filters.pipelineId=a.listPipeline[0].id)}));case 4:if(!(this.listPipeline.length>0)){e.next=8;break}return t=Object(l["a"])(Object(l["a"])({},this.query),this.filters),e.next=8,this.apiDeal.getDataBoard("sales-deals",t).then((function(e){for(var t in a.dataDrag=e,a.dataDrag)a.queryLoadMore[t]={limit:10,currentStageId:t}})).catch((function(e){return a.$message.error(e.message)}));case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"created",value:function(){this.apiDeal=Object(m["a"])("deal",{districtId:this.districtId})}}]),a}(Object(h["b"])(v["a"],C["a"]));Object(u["a"])([w.Action("setDealFilter")],x.prototype,"setDealFilter",void 0),Object(u["a"])([w.Getter("getDealFilter")],x.prototype,"getDealFilter",void 0),Object(u["a"])([Object(h["e"])("paramUpdateDrag")],x.prototype,"handleUpdateDrag",null),x=Object(u["a"])([Object(h["a"])({components:{DealFilter:f["a"],Draggable:O["a"],CreateDeal:g["a"],PopupConfirmDeal:k["a"],PopupNote:y["a"],AppointCustomer:j["a"],EmptyBlock:P["a"],PopupAddUploadFile:_["a"]}})],x);var I=x,L=I,N=(a("57f9"),a("2877")),$=Object(N["a"])(L,i,n,!1,null,"271619f9",null);t["default"]=$.exports}}]);
//# sourceMappingURL=chunk-a854ef32.7f4c06d4.js.map