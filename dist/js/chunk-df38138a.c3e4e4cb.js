(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-df38138a"],{1522:function(t,e,a){},"181e":function(t,e,a){"use strict";a("1522")},7461:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("base-popup",{staticClass:"addUploadFile",attrs:{name:"add-upload-file",open:t.handleOpen,close:t.handleClose,hiddenFooter:!0,width:"520px",top:"5vh"}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("Thêm file tài liệu")]),a("el-upload",{staticClass:"upload body-Upload",attrs:{drag:"",":file-list":t.fileList,"on-change":t.handleChangeFile,"auto-upload":!1,"show-file-list":!1,action:"",multiple:""}},[a("div",{staticClass:"el-upload__text"},[t._v("Kéo thả file hoặc"),a("em",[t._v(" Chọn từ máy tính")])])]),t.fileList.length?a("div",{staticClass:"list-file"},t._l(t.fileList,(function(e){return a("div",{key:e.uid,staticClass:"flex jc-space-between file-item"},[a("div",{staticClass:"left"},[a("p",[t._v(t._s(e.name))])]),a("div",{staticClass:"right",on:{click:function(a){return t.handleDeleteFile(e.uid)}}},[a("base-icon",{staticClass:"icon-action cursor",attrs:{icon:"delete"}})],1)])})),0):t._e(),a("template",{slot:"footer"},[a("div",{staticClass:"bottom"},[a("div",{staticClass:"bt-top flex"},[a("div",{staticClass:"bt-center"},[a("el-button",{staticClass:"group-button-cencel",on:{click:t.handleClose}},[t._v("Hủy")]),t.fileList.length?a("el-button",{staticClass:"be-btn-danger group-button-save",on:{click:t.handleAddFile}},[t._v("Thêm")]):t._e()],1)])])])],2)},i=[],l=a("d0ff"),s=a("c964"),o=a("276c"),c=a("e954"),r=a("920b"),d=a("92a6"),u=(a("b0c0"),a("96cf"),a("9ab4")),p=a("9f48"),h=a("1b40"),f=a("4bb5"),m=a("08ba"),b=a("2ef0"),v=Object(f["a"])("beUser"),g=function(t){Object(r["a"])(a,t);var e=Object(d["a"])(a);function a(){var t;return Object(o["a"])(this,a),t=e.apply(this,arguments),t.fileList=[],t.dataInput={attachFiles:[]},t}return Object(c["a"])(a,[{key:"handleChangeFile",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e){var a,n,i,l,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=new FormData,"ready"!==e.status){t.next=16;break}return e.type=e.raw.type,this.fileList.push(e),a.append("files",e.raw),e.percentage=1,n=function(t){var a=t.loaded/t.total*100;e.percentage=a},i={},i.data=a,i.progress=n,l=e.uid,t.next=13,this.apiUpload.uploadFile(i);case 13:s=t.sent,o=Object(b["findIndex"])(this.fileList,(function(t){return t.uid===l})),this.fileList[o].url=s.success[0].url;case 16:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"handleDeleteFile",value:function(t){this.fileList=Object(b["filter"])(this.fileList,(function(e){return e.uid!==t}))}},{key:"handleAddFile",value:function(){var t,e,a=this;(this.fileList.length&&(this.dataInput.attachFiles=Object(l["a"])(this.fileList)),this.idUpload&&"customer"==this.$route.name||"customerNewsfeed"==this.$route.name)?null===(t=this.api)||void 0===t||t.uploadFile(this.idUpload,this.dataInput).then((function(t){a.$message.success("Upload file thành công"),a.fileList=[],a.$emit("load"),a.handleClose()})).catch((function(t){console.log(t)})):null===(e=this.api)||void 0===e||e.uploadFileDeal(this.idUploadDeal,this.dataInput).then((function(t){a.$message.success("Upload file thành công"),a.fileList=[],a.$emit("load"),a.handleClose()})).catch((function(t){console.log(t)}))}},{key:"handleOpen",value:function(){console.log("test id bên khách hàng",this.idUpload),console.log("test id dell",this.idUploadDeal),console.log("route",this.$route)}},{key:"handleClose",value:function(){this.fileList=[],this.setOpenPopup({popupName:"add-upload-file",isOpen:!1})}},{key:"created",value:function(){var t,e,a,n;this.apiUpload=Object(m["a"])("upload",{districtId:null===(t=this.user)||void 0===t||null===(e=t.districts)||void 0===e?void 0:e[0].id}),this.api=Object(m["a"])("category",{districtId:null===(a=this.user)||void 0===a||null===(n=a.districts)||void 0===n?void 0:n[0].id})}}]),a}(Object(h["b"])(p["a"]));Object(u["a"])([v.State("user")],g.prototype,"user",void 0),Object(u["a"])([Object(h["c"])()],g.prototype,"idUpload",void 0),Object(u["a"])([Object(h["c"])()],g.prototype,"idUploadDeal",void 0),g=Object(u["a"])([Object(h["a"])({components:{}})],g);var C=g,w=C,k=(a("181e"),a("2877")),_=Object(k["a"])(w,n,i,!1,null,null,null);e["a"]=_.exports},"8a2e":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:t.classDeal},[t.showCustomer?t._e():a("base-table",{ref:"tableDeal",attrs:{data:t.data,isLoading:t.isLoading,table:t.table,filters:t.filters,showPagination:!0,paginationInfo:"cơ hội",rowKey:"id",emptyText:"Không có dữ liệu cơ hội bán hàng"},on:{selectionChange:t.handleSelection,sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange,filterChange:t.handleFiltersChange,rowClick:t.handleRowClick},scopedSlots:t._u([{key:"header",fn:function(e){var n=e.filters,i=e.events;return a("div",{staticClass:"be-flex align-center header"},[a("deal-filter",{staticClass:"be-flex-item",attrs:{filters:n,isPipeline:!1},on:{change:i}}),a("div",{staticClass:"actions"},[t.dataSelect.length>0?a("el-dropdown",{staticClass:"batch-action",attrs:{size:"medium","split-button":"",placement:"bottom-end"},on:{command:function(e){return t.handleClickOpenAction({status:"assign-batch",id:""})}}},[t._v(" Thao tác "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[t._v("Gán phụ trách")])],1)],1):t._e(),a("el-dropdown",{staticClass:"custom-button",attrs:{size:"medium","split-button":""},on:{click:function(e){return t.handleClickOpenAction({status:"add",id:""})}}},[t._v(" Thêm mới "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[t._v("Thêm mới từ Excel")])],1)],1),t.btnAddSingle?t._e():a("el-button",{staticClass:"custom-button",attrs:{loading:!1}},[a("span",{staticClass:"be-inline-flex align-center"},[a("base-icon",{staticClass:"icon",attrs:{icon:"excel-fullcolor"}}),t._v(" Xuất Excel ")],1)])],1)],1)}}],null,!1,2413951413)},[a("el-table-column",{attrs:{type:"index",width:"61",label:"#",index:t.renderIndex,align:"center"}}),a("el-table-column",{attrs:{type:"selection",width:"60",align:"center"}}),a("el-table-column",{attrs:{label:"Tên cơ hội",prop:"name","min-width":"260px"}}),a("el-table-column",{attrs:{width:"40px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popover",{attrs:{placement:"bottom","popper-class":"popper-action-deal"},on:{hide:t.hideAction},nativeOn:{click:function(e){return t.handleConflictClick.apply(null,arguments)}}},[a("div",{staticClass:"be-flex-column content"},[a("div",{staticClass:"content-item cursor",on:{click:function(a){return t.handleClickOpenAction({status:"edit",id:e.row.id})}}},[a("span",[t._v("Sửa thông tin")])]),a("div",{staticClass:"content-item cursor",on:{click:function(a){return t.handleClickOpenAction({status:"assign",id:e.row.id,data:e.row})}}},[a("span",[t._v("Gán phụ trách")])]),a("div",{staticClass:"content-item cursor",on:{click:function(a){return t.handleOpenPopupNote(e.row)}}},[a("span",[t._v("Ghi chú")])]),a("div",{staticClass:"content-item cursor",on:{click:function(a){return t.handleClickOpenAction({status:"createCalen",data:e.row,id:e.row.customerId})}}},[a("span",[t._v("Tạo lịch hẹn")])]),a("div",{staticClass:"content-item cursor",on:{click:function(a){return t.handleClickOpenAction({status:"uploadFile",id:e.row.id})}}},[a("span",[t._v("Upload tài liệu")])]),a("div",{staticClass:"content-item cursor",on:{click:function(a){return t.handleClickOpenAction({status:"delete",id:e.row.id})}}},[a("span",[t._v("Xóa cơ hội")])])]),a("div",{staticClass:"reference",attrs:{slot:"reference"},slot:"reference"},[a("i",{staticClass:"el-icon-more"})])])]}}],null,!1,3831815525)}),a("el-table-column",{attrs:{label:"tRẠNG THÁI",prop:"dealStatus","min-width":"164px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.getStatus(e.row.dealStatus))+" ")]}}],null,!1,3135767718)}),a("el-table-column",{attrs:{label:"Nhân viên phụ trách",prop:"salesFullName","min-width":"264px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-row",{staticClass:"flex row-avt"},[a("el-col",{staticClass:"flex"},[e.row.salesMemberId&&e.row.salesAvatar?a("el-avatar",{attrs:{src:e.row.salesAvatar,fit:"cover",size:"small"}}):a("base-icon",{staticClass:"avatar__imployee--defalt",attrs:{icon:"icon-avatar-default"}})],1),a("el-col",[a("p",{staticClass:"checkLength"},[t._v(t._s(e.row.salesFullName))]),a("small",{staticClass:"small"},[t._v(t._s(e.row.salesMemberNo))])])],1)]}}],null,!1,2534104968)}),a("el-table-column",{attrs:{label:"Khách hàng",prop:"customerFullName","min-width":"220px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-row",{staticClass:"flex row-avt"},[a("el-col",{staticClass:"flex"},[e.row.customerAvatar?a("el-avatar",{attrs:{src:e.row.customerAvatar,fit:"cover",size:"small"}}):a("base-icon",{staticClass:"avatar__imployee--defalt",attrs:{icon:"icon-avatar-default"}})],1),a("el-col",[a("p",{staticClass:"checkLength"},[t._v(t._s(e.row.customerFullName))])])],1)]}}],null,!1,3970414896)}),a("el-table-column",{attrs:{label:"Giá trị",prop:"dealValue","min-width":"140px",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("formatNumber")(e.row.dealValue))+" ")]}}],null,!1,2324791491)}),a("el-table-column",{attrs:{label:"Ngày chốt",prop:"closeDate","min-width":"140px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("formatDateTime")(e.row.closeDate))+" ")]}}],null,!1,1609157988)}),a("el-table-column",{attrs:{label:"Giai đoạn",prop:"currentStageName","min-width":"140px",align:"left"}}),a("el-table-column",{attrs:{label:"Xác suất",prop:"probability","min-width":"140px",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("formatPercent")(e.row.probability))+" ")]}}],null,!1,2348880977)})],1),t.showCustomer?a("base-table",{ref:"tableDeal",attrs:{data:t.data,isLoading:t.isLoading,table:t.table,filters:t.filters,showPagination:!0,paginationInfo:"cơ hội",rowKey:"id",emptyText:"Không có dữ liệu cơ hội bán hàng"},on:{selectionChange:t.handleSelection,sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange,filterChange:t.handleFiltersChange,rowClick:t.handleRowClick},scopedSlots:t._u([{key:"header",fn:function(e){var n=e.filters,i=e.events;return a("div",{staticClass:"be-flex align-center header"},[a("deal-filter",{staticClass:"be-flex-item",attrs:{filters:n,isPipeline:!1},on:{change:i}}),a("div",{staticClass:"actions"},[t.dataSelect.length>0?a("el-dropdown",{staticClass:"batch-action",attrs:{size:"medium","split-button":"",placement:"bottom-end"},on:{command:function(e){return t.handleClickOpenAction({status:"assign-batch",id:""})}}},[t._v(" Thao tác "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[t._v("Gán phụ trách")])],1)],1):t._e(),a("el-button",{staticClass:"be-btn-danger",on:{click:t.handleOpenAddDeal}},[t._v("Thêm mới")]),t.btnAddSingle?t._e():a("el-button",{staticClass:"custom-button",attrs:{loading:!1}},[a("span",{staticClass:"be-inline-flex align-center"},[a("base-icon",{staticClass:"icon",attrs:{icon:"excel-fullcolor"}}),t._v(" Xuất Excel ")],1)])],1)],1)}}],null,!1,3240682884)},[a("el-table-column",{attrs:{type:"index",width:"61",label:"#",index:t.renderIndex,align:"center"}}),a("el-table-column",{attrs:{label:"Tên cơ hội",prop:"name","min-width":"280px"}}),a("el-table-column",{attrs:{label:"tRẠNG THÁI",prop:"dealStatus","min-width":"180px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.getStatus(e.row.dealStatus))+" ")]}}],null,!1,3135767718)}),a("el-table-column",{attrs:{label:"Ngày chốt",prop:"closeDate","min-width":"132px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("formatDateTime")(e.row.closeDate))+" ")]}}],null,!1,1609157988)}),a("el-table-column",{attrs:{label:"Giá trị",prop:"dealValue","min-width":"132px",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("formatNumber")(e.row.dealValue))+" ")]}}],null,!1,2324791491)}),a("el-table-column",{attrs:{label:"",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(t){return[t.row.salesAvatar?a("el-avatar",{attrs:{src:t.row.salesAvatar,fit:"cover",size:"small"}}):a("base-icon",{staticClass:"avatar__imployee--defalt",attrs:{icon:"icon-avatar-default"}})]}}],null,!1,3596675605)})],1):t._e(),t.checkRouter?a("create-deal",{attrs:{dataProp:t.dataPopup},on:{apply:t.init,openDestroy:t.handleClickOpenAction}}):t._e(),a("popup-confirm-deal",{attrs:{dataProp:t.dataPopup},on:{confirm:t.handleConfirm}}),a("appoint-customer",{attrs:{dataRows:t.dataRow,idCustomer:t.idCustomer}}),a("popup-note",{attrs:{type:t.type},on:{update:t.handleCreateNote}}),a("popup-add-upload-file",{attrs:{idUploadDeal:t.idUploadDeal},on:{load:t.loadData}})],1)},i=[],l=a("c964"),s=a("276c"),o=a("e954"),c=a("920b"),r=a("92a6"),d=(a("96cf"),a("caad"),a("2532"),a("d3b7"),a("25f0"),a("b0c0"),a("9ab4")),u=a("1b40"),p=a("7fd9"),h=a("08ba"),f=a("c56f"),m=a("2ef0"),b=a("be17"),v=a("9f48"),g=a("1572"),C=a("222c"),w=a("d67a"),k=a("1f2a"),_=a("4bb5"),y=a("7461"),O=Object(_["a"])("beDeal"),x=function(t){Object(c["a"])(a,t);var e=Object(r["a"])(a);function a(){var t;return Object(s["a"])(this,a),t=e.apply(this,arguments),t.data=[],t.isLoading=!1,t.filters={},t.table={total:0,page:1,limit:20},t.dataPopup={title:"",code:"",id:"",data:{},dataSelect:[]},t.dataRow={data:{}},t.idCustomer="",t.idUploadDeal="",t.dataSelect=[],t.isConflictClick=!1,t.dealId=0,t.type="add",t}return Object(o["a"])(a,[{key:"checkRouter",get:function(){return!Object(m["includes"])(this.$route.path,"khach-hang")}},{key:"btnAddSingle",get:function(){return!!this.$route.path.includes("khach-hang")}},{key:"showCustomer",get:function(){return this.$route.path.includes("khach-hang")}},{key:"classDeal",get:function(){return this.$route.path.includes("khach-hang")?"deal-page deal-customer":"deal-page"}},{key:"getStatus",value:function(t){var e="";switch(t){case"1":e="Đang làm việc";break;case"2":e="Thành công";break;case"3":e="Thất bại";break;default:e="";break}return e}},{key:"handleOpenPopupNote",value:function(t){this.dealId=t.id,this.setOpenPopup({popupName:"popup-note",isOpen:!0})}},{key:"handleCreateNote",value:function(t){var e=this,a="DEAL";this.apiDeal.createNote(a,{description:t.content,dealId:this.dealId}).then((function(){e.$message.success("Tạo ghi chú thành công"),e.init()}))}},{key:"loadData",value:function(){this.init()}},{key:"handleConfirm",value:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(e){var a,n=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null===(a=this.$refs.tableDeal)||void 0===a||a.clearSelection(),this.dataSelect=[],"delete"!=this.dataPopup.code){t.next=8;break}if(!this.dataPopup.id||0==this.dataPopup.id){t.next=6;break}return t.next=6,this.apiDeal.deleteDealOrCusById("sales-deals",Object(m["trim"])(this.dataPopup.id.toString())).then((function(){n.$message.success("Xóa thành công"),n.setOpenPopup({popupName:"popup-confirm-deal",isOpen:!1}),n.init()})).catch((function(t){return n.$message.error(t.message)}));case 6:t.next=10;break;case 8:return t.next=10,this.apiDeal.assignDeal("sales-deals",e).then((function(){n.$message.success("Gán thành công"),n.setOpenPopup({popupName:"popup-confirm-deal",isOpen:!1}),n.init()})).catch((function(t){return n.$message.error(t.message)}));case 10:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"handleSelection",value:function(t){this.dataSelect=t}},{key:"renderIndex",value:function(t){return(this.table.page-1)*this.table.limit+t+1}},{key:"handleSizeChange",value:function(t){this.table.limit=t,this.init()}},{key:"handleCurrentChange",value:function(t){this.table.page=t,this.init()}},{key:"handleFiltersChange",value:function(t){this.setDealFilter({dealName:this.$route.name,filters:t,data:t.dataChange||{}}),delete t.dataChange,this.filters=t,this.init()}},{key:"handleConflictClick",value:function(){this.isConflictClick=!0}},{key:"hideAction",value:function(){this.isConflictClick=!1}},{key:"handleRowClick",value:function(t){this.isConflictClick||this.$router.push({name:"dealNewsfeed",params:{type:this.$route.params.type,view:"bang-tin",id:t.row.id}})}},{key:"handleClickOpenAction",value:function(t){var e=t.status,a=t.id;this.dataPopup.code=e,this.dataPopup.id=a,(e.includes("assign")||"delete"==e)&&(this.dataPopup.title="delete"==e?"Xác nhận xóa":"Gán Nhân viên phụ trách",this.dataPopup.data=null===t||void 0===t?void 0:t.data,this.dataPopup.dataSelect=this.dataSelect,this.setOpenPopup({popupName:"popup-confirm-deal",isOpen:!0})),"add"!=e&&"edit"!=e||(this.dataPopup.title="add"==e?"Thêm mới cơ hội bán hàng":"Sửa thông tin cơ hội bán hàng",this.setOpenPopup({popupName:"create-deal",isOpen:!0})),"createCalen"==e&&(this.idCustomer=a,this.dataRow=null===t||void 0===t?void 0:t.data,console.log("dataDealPage",this.dataRow),this.setOpenPopup({popupName:"appoint-customer",isOpen:!0})),"uploadFile"==e&&(this.idUploadDeal=a,console.log("idUploadDeal",this.idUploadDeal),this.setOpenPopup({popupName:"add-upload-file",isOpen:!0}))}},{key:"init",value:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(){var e,a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.isLoading=!0,e=Object(m["assign"])(this.filters,this.table),this.$route.path.includes("khach-hang")&&(e.customerId=this.$route.params.id),delete e.total,t.next=6,this.apiDeal.getData("sales-deals",e).then((function(t){a.data=t.content,a.table.total=t.totalElements}));case 6:this.isLoading=!1;case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"handleOpenAddDeal",value:function(){k["a"].$emit("addDaalDetail")}},{key:"created",value:function(){var t=this;this.apiDeal=Object(h["a"])("deal",{districtId:this.districtId}),k["a"].$on("reloadDetailHeader",(function(){t.init()}))}}]),a}(Object(u["b"])(f["a"],v["a"]));Object(d["a"])([O.Action("setDealFilter")],x.prototype,"setDealFilter",void 0),Object(d["a"])([O.Getter("getDealFilter")],x.prototype,"getDealFilter",void 0),x=Object(d["a"])([Object(u["a"])({components:{DealFilter:p["a"],CreateDeal:b["a"],PopupConfirmDeal:g["a"],PopupNote:C["a"],AppointCustomer:w["a"],PopupAddUploadFile:y["a"]}})],x);var D=x,S=D,j=a("2877"),P=Object(j["a"])(S,n,i,!1,null,"20ce572e",null);e["default"]=P.exports}}]);
//# sourceMappingURL=chunk-df38138a.c3e4e4cb.js.map