(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0050192c"],{"05fe":function(t,e,a){"use strict";a("0ab7")},"0ab7":function(t,e,a){},"44af":function(t,e,a){"use strict";a("543c")},"543c":function(t,e,a){},"65f9":function(t,e,a){},"72cf":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"import-page"},[a("div",{staticClass:"be-flex main-action"},[a("div",{staticClass:"main-action__left"},[a("import-filter",{on:{search:t.handleSearch,filterDate:t.handleFilterDate,filterStatus:t.handleFilterStatus,filterUser:t.handleFilterUser}})],1),a("div",{staticStyle:{display:"flex"}},[a("el-button",{staticClass:"custom-button",staticStyle:{"margin-right":"10px"},attrs:{loading:t.isLoadingButton},on:{click:t.handleOpenExportFile}},[a("span",{staticClass:"be-inline-flex align-center"},[a("base-icon",{staticClass:"icon",attrs:{icon:"excel-fullcolor"}}),t._v(" Tải file mẫu ")],1)]),a("button",{staticClass:"cursor btn_upload",on:{click:t.UploadFileYear}},[t._v("Upload file")])],1)]),a("div",{staticClass:"import-table"},[a("base-table",{attrs:{data:t.data,table:t.query,paginationInfo:"file","is-loading":t.isLoading,emptyText:"Không có dữ liệu cập nhật"},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange,rowClick:t.handleGetDetail}},[a("el-table-column",{attrs:{index:t.getIndex,type:"index",label:"#",width:"80",align:"center"}}),a("el-table-column",{attrs:{prop:"fileName",label:"TÊN"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",[t._v(t._s(e.row.fileName))]),e.row.size?a("span",{staticClass:"small"},[t._v(t._s(t._f("bytesToSize")(e.row.size)))]):t._e()]}}])}),a("el-table-column",{attrs:{prop:"peopleUpload",label:"NGƯỜI TẢI LÊN",width:"280"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"flex wrap-name"},[a("div",{staticClass:"flex-item-avatar"},[a("base-avatar",{attrs:{url:e.row.avatar,size:"xs"}})],1),a("div",{staticClass:"flex-item-name"},[t._v(" "+t._s(e.row.userName)),a("br"),a("span",{staticClass:"small"},[t._v(" "+t._s(e.row.userCode))])])])]}}])}),a("el-table-column",{attrs:{prop:"date_time",label:"NGÀY GIỜ",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("formatDateHour")(e.row.createdAt)))])]}}])}),a("el-table-column",{attrs:{prop:"status",label:"TRẠNG THÁI",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return["IN_PROGRESS"===e.row.status||"NEW"===e.row.status||"SUCCESS"===e.row.status?a("span",{staticClass:"status processing"},[t._v("Đang xử lý")]):t._e(),"FAIL"===e.row.status?a("span",{staticClass:"status error_data"},[t._v("Lỗi dữ liệu")]):t._e(),"COMPLETED"===e.row.status?a("span",{staticClass:"status processed"},[t._v("Đã xử lý")]):t._e()]}}])})],1)],1),a("import-file-detail",{attrs:{"detail-file":t.detailFile,"is-error":t.isError}}),a("upload-file-year",{on:{apply:t.init}})],1)},n=[],l=a("f3f3"),s=a("c964"),r=a("276c"),o=a("e954"),c=a("920b"),u=a("92a6"),d=(a("96cf"),a("4de4"),a("ac1f"),a("841c"),a("a15b"),a("9ab4")),h=a("1b40"),p=a("9f48"),f=a("c56f"),b=a("08ba"),m=a("4bb5"),g=a("494c"),v=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("base-popup",{staticClass:"popup-file-detail",attrs:{name:"detail-file-kpi-year",open:t.handleOpen,close:t.handleClose,width:"1240px",hiddenFooter:!0}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("Nội dung file")]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoadingPopup,expression:"isLoadingPopup"}],staticClass:"body-content"},[a("div",{staticClass:"body-content__header"},[a("div",{staticClass:"be-flex-column header-file-name"},[a("span",{staticClass:"file-name"},[t._v(t._s(t.fileName))]),a("div",{staticClass:"be-flex wrap-user-name"},[a("base-avatar",{attrs:{url:t.detailFile.avatar,size:"xs"}}),a("span",{staticClass:"user-name"},[t._v(t._s(t.detailFile.userName))]),a("span",{staticClass:"date-time"},[t._v(t._s(t._f("formatDateHour")(t.detailFile.createdAt)))])],1)])]),t.isError?t._e():a("div",{staticClass:"body-content__table body-content__table--error"},[a("base-tree-table",{attrs:{maxHeight:t.tableHeight,data:t.data,table:t.query,isLoading:t.isLoading,paginationInfo:"dòng",showPagination:!0},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange}},[a("el-table-column",{attrs:{index:t.getIndex,type:"index",label:"#",width:"80",align:"center"}}),a("el-table-column",{attrs:{label:"Tên ĐVKD",align:"left",width:"250px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"business-unit-code"},[t._v(t._s(e.row.branchType))]),a("span",[t._v("- "+t._s(e.row.branchName))])]}}],null,!1,3042252326)}),a("el-table-column",{attrs:{label:"Mã ĐVKD",width:"100",align:"center",prop:"branchCode"}}),a("el-table-column",{attrs:{label:"Mã ĐVQL",prop:"managementCode",align:"center",width:"100px"}}),a("el-table-column",{attrs:{label:"Kế hoạch kinh doanh năm",align:"center"}},[a("el-table-column",{attrs:{label:"FYP",width:"130px",prop:"revenueYear1",align:"right"}}),a("el-table-column",{attrs:{label:"Phí dịch vụ",align:"center"}},[a("el-table-column",{attrs:{align:"right",label:"Năm 1",prop:"commissionYear1",width:"130px"}}),a("el-table-column",{attrs:{align:"right",label:"K2",prop:"commissionK2",width:"130px"}}),a("el-table-column",{attrs:{align:"right",label:"Tổng",prop:"commission",width:"130px"}})],1)],1),a("el-table-column",[a("el-table-column",{attrs:{label:"Tháng 1",align:"center"}},[a("el-table-column",{attrs:{label:"FYP",prop:"revenueT1",align:"right",width:"130px"}}),a("el-table-column",{attrs:{label:"Thu phí dịch vụ",prop:"commissionT1",align:"right",width:"140px"}})],1)],1),a("el-table-column",{attrs:{label:"Lũy kế từ đầu năm",align:"center"}},t._l(11,(function(e){return a("el-table-column",{key:e,attrs:{label:"Tháng "+(e+1),align:"center"}},[a("el-table-column",{attrs:{label:"FYP",align:"right",width:"130px"},scopedSlots:t._u([{key:"default",fn:function(a){var i=a.row;return[t._v(t._s(i["revenueT"+(e+1)]))]}}],null,!0)}),a("el-table-column",{attrs:{label:"Thu phí dịch vụ",align:"right",width:"140px"},scopedSlots:t._u([{key:"default",fn:function(a){var i=a.row;return[t._v(t._s(i["commissionT"+(e+1)]))]}}],null,!0)})],1)})),1)],1)],1),t.isError?a("div",{staticClass:"body-content__content body-content__content--error"},[a("div",{staticClass:"text-column"},[a("div",{staticClass:"be-flex text-item"},[a("span",{staticClass:"text-item__title"},[t._v("Số dòng lỗi format")]),a("span",{staticClass:"text-item__number text-bold"},[t._v(t._s(t.errorCount))])])])]):t._e(),t.isError?a("div",{staticClass:"body-content__table body-content__table--error"},[a("base-table",{attrs:{data:t.dataError,table:t.query,isLoading:t.isLoading,paginationInfo:"dòng"},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange}},[a("el-table-column",{attrs:{index:t.getIndex,type:"index",label:"#",width:"80",align:"center"}}),a("el-table-column",{attrs:{label:"stt dòng",width:"90",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.rowIndex)+" ")]}}],null,!1,3765580137)}),a("el-table-column",{attrs:{width:"20"}}),a("el-table-column",{attrs:{label:"mô tả lỗi"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.description)+" ")]}}],null,!1,1461819547)})],1)],1):t._e()])])},y=[],_=(a("b0c0"),a("2ef0")),C=a("6d3f"),w=a("ef28"),O=a("81f4"),x=a("385e"),k=a("d599"),I=a("37ef"),j=a("22d2"),S=a("46e4"),T=a("a77c"),F=a("65e2"),E=Object(b["a"])("import"),N=function(t){Object(c["a"])(a,t);var e=Object(u["a"])(a);function a(){var t;return Object(r["a"])(this,a),t=e.apply(this,arguments),t.data=[],t.detail={},t.tabs=[{id:0,name:"TỔNG HỢP LỖI",active:!0},{id:1,name:"KHKD"},{id:2,name:"PHI_PHAT_SINH"},{id:3,name:"HD_MOI"},{id:4,name:"HD_HUY"},{id:5,name:"HD_TAI_TUC"},{id:6,name:"HO_SO_PENDING"},{id:7,name:"HO_SO_TU_CHOI"},{id:8,name:"HD_MAT_HIEU_LUC"},{id:9,name:"DS_NHAC_THU_PHI_TAI_TUC"}],t.tableHeight="auto",t.errorRow=[],t.dataError=[],t.totalErrorCount=0,t.sheetAactive="KPI_DVKD",t.isLoading=!1,t.isLoadingPopup=!1,t.query={page:1,limit:20,total:0},t}return Object(o["a"])(a,[{key:"getHeightOfTable",value:function(){this.tableHeight="".concat(window.innerHeight-123,"px")}},{key:"mounted",value:function(){this.getHeightOfTable()}},{key:"getIndex",get:function(){return this.query.limit*(this.query.page-1)+1}},{key:"fileName",get:function(){return this.detailFile&&this.detailFile.fileName?this.detailFile.fileName.replaceAll(".xlsx"," "):""}},{key:"errorCount",get:function(){var t=this,e=Object(_["filter"])(this.errorRow,(function(e){return e.sheetName===t.sheetAactive}));return e.length?e[0].errorCount:!e.length&&this.sheetAactive?0:this.totalErrorCount}},{key:"handleOpen",value:function(){var t=this;this.isError?this.getSheetsName().then((function(){t.init()})):this.isError?this.tabs[0].active=!1:(this.tabs.shift(),this.tabs[0].active=!0,this.init())}},{key:"getSheetsName",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={fileId:this.detailFile.id},t.next=3,E.getSheetsName(this.districtId,e).then((function(t){a.errorRow=t.data.data,a.tabs[0].active=!0,a.tabs[0].subactive=!0,a.tabs[1].active=!1,a.sheetAactive=null,Object(_["forEach"])(a.tabs,(function(e){Object(_["forEach"])(t.data.data,(function(t){e.name===t.sheetName&&(e.subactive=!0)}))}))}));case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"init",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e?this.isLoading=!0:this.isLoadingPopup=!0;var a=Object(l["a"])(Object(l["a"])({},this.query),{},{total:null,fileId:this.detailFile.id,sheetName:this.sheetAactive});E.getDetail(this.districtId,this.isError,a).then((function(a){console.log(a.list[0]),t.isError?(t.dataError=a.list,t.totalErrorCount=a.total,t.query.total=t.errorCount):(t.detail=a.total,t.data=a.list,t.query.total=a.total.numOfRow),e?t.isLoading=!1:t.isLoadingPopup=!1})).catch((function(a){e?t.isLoading=!1:t.isLoadingPopup=!1,t.$message.error(a.message)}))}},{key:"handleClose",value:function(){this.isError||this.tabs.unshift({id:0,name:"Tổng hợp lỗi",active:!0}),this.detail={},this.dataError=[],this.errorRow=[],this.sheetAactive="KPI_DVKD",Object(_["forEach"])(this.tabs,(function(t){1===t.id?t.active=!0:(delete t.active,delete t.subactive)}))}},{key:"handleSizeChange",value:function(t){this.query.limit=t,this.init(!0)}},{key:"handleCurrentChange",value:function(t){this.query.page=t,this.init(!0)}}]),a}(Object(h["b"])(p["a"],f["a"]));Object(d["a"])([Object(h["c"])({required:!1,type:Object,default:{}})],N.prototype,"detailFile",void 0),Object(d["a"])([Object(h["c"])({required:!1,type:Boolean,default:!1})],N.prototype,"isError",void 0),N=Object(d["a"])([Object(h["a"])({components:{BaseTable:w["a"],BaseIcon:C["a"],HdTable:O["a"],HsTable:x["a"],PendingTable:k["a"],RejectTable:I["a"],InactiveTable:j["a"],ReminderTable:S["a"],IncurredTable:T["a"],TaiTucTable:F["a"]}})],N);var L=N,H=L,P=(a("05fe"),a("2877")),D=Object(P["a"])(H,v,y,!1,null,"77111947",null),q=D.exports,A=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("base-popup",{staticClass:"upload-file-year",attrs:{name:"upload-file-year",width:"286px",hiddenFooter:!0,close:t.handleClose}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("Chọn thời gian")]),a("div",{staticClass:"content"},[a("div",[a("div",{staticClass:"content-right"},[a("div",{staticClass:"title"},[a("span",[t._v("Năm")])]),a("el-date-picker",{attrs:{size:"medium",type:"year","value-format":"yyyy",placeholder:"Năm",clearable:!1,width:"160px!important"},model:{value:t.valueYear,callback:function(e){t.valueYear=e},expression:"valueYear"}})],1)])]),a("div",{staticClass:"bottom"},[a("button",{staticClass:"btn-close",on:{click:t.handleClose}},[t._v("Huỷ")]),a("el-upload",{staticClass:"upload-demo",attrs:{action:"","auto-upload":!1,accept:t._f("joinArray")(t.fileAccept),"show-file-list":!1,"on-change":t.handleChangeFile}},[a("button",{staticClass:"btn-upload",on:{click:t.handleChangeFile}},[t._v("Upload file")])])],1)])},R=[],U=a("c178"),Y=Object(b["a"])("import"),K=function(t){Object(c["a"])(a,t);var e=Object(u["a"])(a);function a(){var t;return Object(r["a"])(this,a),t=e.apply(this,arguments),t.valueYear=(new Date).getFullYear()+"",t.fileAccept=U["a"],t}return Object(o["a"])(a,[{key:"handleClose",value:function(){this.setOpenPopup({popupName:"upload-file-year",isOpen:!1})}},{key:"handleChangeFile",value:function(t){this.uploadFile(t)}},{key:"uploadFile",value:function(t){var e=this,a=new FormData;"ready"===t.status&&(a.append("file",t.raw),a.append("name",t.name),a.append("type","KPI_YEAR"),a.append("year",this.valueYear),this.$message.success("Đang tải file lên"),Y.uploadFile(this.districtId,a).then((function(){e.$message.success("Tải lên thành công"),e.handleClose(),e.$emit("apply")})).catch((function(t){429===t.errorCode?(e.$message.error("Không upload được file khi hệ thống đang cập nhật dữ liệu. Vui lòng thử lại sau ít phút"),e.handleClose()):(e.$message.error("Tải lên thất bại"),e.handleClose())})))}}]),a}(Object(h["b"])(p["a"]));K=Object(d["a"])([Object(h["a"])({components:{}})],K);var z=K,G=z,$=(a("903a"),Object(P["a"])(G,A,R,!1,null,"43040eb5",null)),B=$.exports,Q=Object(m["a"])("beUser"),V=Object(b["a"])("import"),M=function(t){Object(c["a"])(a,t);var e=Object(u["a"])(a);function a(){var t;return Object(r["a"])(this,a),t=e.apply(this,arguments),t.data=[],t.isLoadingButton=!1,t.query={page:1,limit:20,total:0},t.filter={search:"",fd:"",td:"",status:"",userIds:""},t.detailFile={},t.isError=!1,t.isLoading=!1,t.params={type:"KPI_YEAR"},t.isSpace=!1,t}return Object(o["a"])(a,[{key:"mounted",value:function(){this.init()}},{key:"getIndex",get:function(){return this.query.limit*(this.query.page-1)+1}},{key:"init",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.isLoading=!0,e=Object(l["a"])(Object(l["a"])({},this.query),{},{search:this.filter.search?this.filter.search:null,fd:this.filter.fd?this.filter.fd:null,td:this.filter.td?this.filter.td:null,status:this.filter.status?this.filter.status:null,userIds:this.filter.userIds?this.filter.userIds:null,total:null,type:"KPI_YEAR"}),t.next=4,V.getData(this.districtId,e);case 4:a=t.sent,this.data=a.files,this.query.total=a.total,this.isLoading=!1;case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"UploadFileYear",value:function(){this.setOpenPopup({popupName:"upload-file-year",isOpen:!0})}},{key:"handleSearch",value:function(t){this.resetQuery(),this.isLoading||(this.filter.search=Object(_["trim"])(t),this.init())}},{key:"created",value:function(){var t,e;this.apiImport=Object(b["a"])("import",{districtId:null===(t=this.user)||void 0===t||null===(e=t.districts)||void 0===e?void 0:e[0].id})}},{key:"handleOpenExportFile",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a,i=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.isLoadingButton=!0,t.next=3,null===(e=this.apiImport)||void 0===e?void 0:e.spamleFile(this.districtId,this.params).then((function(t){a=t.data;var e=document.createElement("a");e.style.display="none",e.href=a,document.body.appendChild(e),e.click(),document.body.removeChild(e),i.isLoadingButton=!1,i.isLoadingButton=!1})).catch((function(t){console.log(t),i.isLoadingButton=!1}));case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"handleFilterDate",value:function(t){this.resetQuery(),this.filter.fd=t.fd,this.filter.td=t.td,this.init()}},{key:"handleFilterStatus",value:function(t){this.resetQuery(),this.filter.status=t.join(","),this.init()}},{key:"handleFilterUser",value:function(t){this.resetQuery(),this.filter.userIds=t.join(","),this.init()}},{key:"handleSizeChange",value:function(t){this.query.limit=t,this.init()}},{key:"handleCurrentChange",value:function(t){this.query.page=t,this.init()}},{key:"handleGetDetail",value:function(t){this.detailFile=t.row,this.isError="FAIL"===t.row.status,"IN_PROGRESS"!==t.row.status&&"NEW"!==t.row.status&&"SUCCESS"!==t.row.status?this.setOpenPopup({popupName:"detail-file-kpi-year",isOpen:!0}):this.$message.error("File đang xử lý, vui lòng đợi")}},{key:"resetQuery",value:function(){this.query.page=1,this.query.limit=20}},{key:"hasWhiteSpace",value:function(t){t.indexOf(" ")>=0&&(this.isSpace=!0)}}]),a}(Object(h["b"])(p["a"],f["a"]));Object(d["a"])([Q.State("user")],M.prototype,"user",void 0),M=Object(d["a"])([Object(h["a"])({components:{ImportFilter:g["a"],ImportFileDetail:q,UploadFileYear:B}})],M);var W=M,J=W,X=(a("44af"),Object(P["a"])(J,i,n,!1,null,"08a112c7",null));e["default"]=X.exports},"903a":function(t,e,a){"use strict";a("65f9")}}]);
//# sourceMappingURL=chunk-0050192c.d6286fcf.js.map