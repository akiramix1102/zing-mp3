(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fcb9c14e"],{"0b8e":function(t,e,a){},"66b4":function(t,e,a){},8274:function(t,e,a){"use strict";a("66b4")},"8a28":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"import-page"},[a("div",{staticClass:"be-flex main-action"},[a("div",{staticClass:"main-action__left"},[a("import-filter",{on:{search:t.handleSearch,filterDate:t.handleFilterDate,filterStatus:t.handleFilterStatus,filterUser:t.handleFilterUser}})],1),a("div",{staticStyle:{display:"flex"}},[a("el-button",{staticClass:"custom-button",staticStyle:{"margin-right":"10px"},attrs:{loading:t.isLoadingButton},on:{click:t.handleOpenExportFile}},[a("span",{staticClass:"be-inline-flex align-center"},[a("base-icon",{staticClass:"icon",attrs:{icon:"excel-fullcolor"}}),t._v(" Tải file mẫu ")],1)]),a("el-upload",{staticClass:"upload-demo",attrs:{action:"","auto-upload":!1,accept:t._f("joinArray")(t.fileAccept),"show-file-list":!1,"on-change":t.handleChangeFile}},[a("button",{staticClass:"cursor btn_upload"},[t._v("Upload file")])])],1)]),a("div",{staticClass:"import-table"},[a("base-table",{attrs:{data:t.data,table:t.query,paginationInfo:"file","is-loading":t.isLoading,emptyText:"Không có dữ liệu cập nhật"},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange,rowClick:t.handleGetDetail}},[a("el-table-column",{attrs:{index:t.getIndex,type:"index",label:"#",width:"80",align:"center"}}),a("el-table-column",{attrs:{prop:"fileName",label:"TÊN"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",[t._v(t._s(e.row.fileName))]),e.row.size?a("span",{staticClass:"small"},[t._v(t._s(t._f("bytesToSize")(e.row.size)))]):t._e()]}}])}),a("el-table-column",{attrs:{prop:"peopleUpload",label:"NGƯỜI TẢI LÊN",width:"280"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"flex wrap-name"},[a("div",{staticClass:"flex-item-avatar"},[a("base-avatar",{attrs:{url:e.row.avatar,size:"xs"}})],1),a("div",{staticClass:"flex-item-name"},[t._v(" "+t._s(e.row.userName)),a("br"),a("span",{staticClass:"small"},[t._v(" "+t._s(e.row.userCode))])])])]}}])}),a("el-table-column",{attrs:{prop:"date_time",label:"NGÀY GIỜ",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("formatDateHour")(e.row.createdAt)))])]}}])}),a("el-table-column",{attrs:{prop:"status",label:"TRẠNG THÁI",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return["IN_PROGRESS"===e.row.status||"NEW"===e.row.status||"SUCCESS"===e.row.status?a("span",{staticClass:"status processing"},[t._v("Đang xử lý")]):t._e(),"FAIL"===e.row.status?a("span",{staticClass:"status error_data"},[t._v("Lỗi dữ liệu")]):t._e(),"COMPLETED"===e.row.status?a("span",{staticClass:"status processed"},[t._v("Đã xử lý")]):t._e()]}}])})],1)],1),a("import-file-detail",{attrs:{"detail-file":t.detailFile,"is-error":t.isError}})],1)},s=[],n=a("f3f3"),r=a("c964"),l=a("276c"),o=a("e954"),c=a("920b"),u=a("92a6"),d=(a("96cf"),a("4de4"),a("ac1f"),a("841c"),a("a15b"),a("b0c0"),a("9ab4")),h=a("c178"),f=a("1b40"),b=a("9f48"),p=a("c56f"),m=a("4bb5"),v=a("08ba"),_=a("494c"),g=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("base-popup",{staticClass:"popup-file-detail",attrs:{name:"detail-file",open:t.handleOpen,close:t.handleClose,width:"1240px",hiddenFooter:!0}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("Nội dung file")]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoadingPopup,expression:"isLoadingPopup"}],staticClass:"body-content"},[a("div",{staticClass:"body-content__header"},[a("div",{staticClass:"be-flex-column header-file-name"},[a("span",{staticClass:"file-name"},[t._v(t._s(t.fileName))]),a("div",{staticClass:"be-flex wrap-user-name"},[a("base-avatar",{attrs:{url:t.detailFile.avatar,size:"xs"}}),a("span",{staticClass:"user-name"},[t._v(t._s(t.detailFile.userName))]),a("span",{staticClass:"date-time"},[t._v(t._s(t._f("formatDateHour")(t.detailFile.createdAt)))])],1)])]),a("div",{staticClass:"body-content__tabs"},[a("div",{staticClass:"be-flex menu-tabs"},t._l(t.tabs,(function(e){return a("span",{key:e.id,staticClass:"cursor tab-item",class:e.active&&!t.isError?"tab-active":e.active&&t.isError&&e.subactive?"tab-active-error":t.isError&&e.subactive?"tab-error-sub":t.isError&&e.active?"tab-active":null,on:{click:function(a){return t.handleChangeTab(e)}}},[t._v(t._s(e.name))])})),0)]),t.isError?a("div",{staticClass:"body-content__content body-content__content--error"},[a("div",{staticClass:"text-column"},[a("div",{staticClass:"be-flex text-item"},[a("span",{staticClass:"text-item__title"},[t._v("Số dòng lỗi format")]),a("span",{staticClass:"text-item__number text-bold"},[t._v(t._s(t.errorCount))])])])]):a("div",{staticClass:"be-flex body-content__content"},[a("div",{staticClass:"text-column"},[a("div",{staticClass:"be-flex text-item"},[a("span",{staticClass:"text-item__title"},[t._v("Số dòng dữ liệu")]),a("span",{staticClass:"text-item__number text-bold"},[t._v(t._s(t._f("formatNumber")(t.detail&&t.detail.numOfRow))+"/"+t._s(t._f("formatNumber")(t.detail&&t.detail.numOfRow)))])]),a("div",{staticClass:"be-flex text-item"},[a("span",{staticClass:"text-item__title"},[t._v("Số NVTV")]),a("span",{staticClass:"text-item__number text-bold"},[t._v(t._s(t._f("formatNumber")(t.detail&&t.detail.numberOfConsultants)))])])]),a("div",{staticClass:"text-column"},[a("div",{staticClass:"be-flex text-item"},[a("span",{staticClass:"text-item__title"},[t._v("Số hợp đồng")]),a("span",{staticClass:"text-item__number text-bold"},[t._v(t._s(t._f("formatNumber")(t.detail&&t.detail.numOfContract)))])]),a("div",{staticClass:"be-flex text-item"},[a("span",{staticClass:"text-item__title"},[t._v("Tổng IP")]),a("span",{staticClass:"text-item__number text-bold"},[t._v(t._s(t._f("formatNumber")(t.detail&&t.detail.totalIP)))])])]),a("div",{staticClass:"text-column"},[a("div",{staticClass:"be-flex text-item"},[a("span",{staticClass:"text-item__title"},[t._v("Tổng phí năm")]),a("span",{staticClass:"text-item__number text-bold"},[t._v(t._s(t._f("formatNumber")(t.detail&&t.detail.totalFee)))])])])]),t.isError?a("div",{staticClass:"body-content__table body-content__table--error"},[a("base-table",{attrs:{data:t.dataError,table:t.query,isLoading:t.isLoading,paginationInfo:"dòng"},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange}},[a("el-table-column",{attrs:{index:t.getIndex,type:"index",label:"#",width:"80",align:"center"}}),t.sheetAactive?t._e():a("el-table-column",{attrs:{label:"tên sheet",width:"230"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.sheetName)+" ")]}}],null,!1,1925788725)}),a("el-table-column",{attrs:{label:"stt dòng",width:"90",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.rowIndex)+" ")]}}])}),a("el-table-column",{attrs:{width:"20"}}),a("el-table-column",{attrs:{label:"mô tả lỗi"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.description)+" ")]}}])})],1)],1):a("div",{staticClass:"body-content__table"},["HD_MOI"===t.sheetAactive||"HD_HUY"===t.sheetAactive?a("hd-table",{attrs:{data:t.data,query:t.query,isLoading:t.isLoading},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange}}):t._e(),"HD_TAI_TUC"===t.sheetAactive?a("tai-tuc-table",{attrs:{data:t.data,query:t.query,isLoading:t.isLoading},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange}}):t._e(),"HSYCBH"===t.sheetAactive?a("hs-table",{attrs:{data:t.data,query:t.query,isLoading:t.isLoading},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange}}):t._e(),"PHI_PHAT_SINH"===t.sheetAactive?a("incurred-table",{attrs:{data:t.data,query:t.query,isLoading:t.isLoading},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange}}):t._e(),"HO_SO_PENDING"===t.sheetAactive?a("pending-table",{attrs:{data:t.data,query:t.query,isLoading:t.isLoading},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange}}):t._e(),"HO_SO_TU_CHOI"===t.sheetAactive?a("reject-table",{attrs:{data:t.data,query:t.query,isLoading:t.isLoading},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange}}):t._e(),"HD_MAT_HIEU_LUC"===t.sheetAactive?a("inactive-table",{attrs:{data:t.data,query:t.query,isLoading:t.isLoading},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange}}):t._e(),"DS_NHAC_THU_PHI_TAI_TUC"===t.sheetAactive?a("reminder-table",{attrs:{data:t.data,query:t.query,isLoading:t.isLoading},on:{sizeChange:t.handleSizeChange,currentChange:t.handleCurrentChange}}):t._e()],1)])])},C=[];a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0");function y(t){return y="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}var x=a("2ef0"),O=a("6d3f"),S=a("ef28"),w=a("81f4"),I=a("385e"),k=a("d599"),j=a("37ef"),H=a("22d2"),L=a("46e4"),N=a("a77c"),T=a("65e2"),E=Object(v["a"])("import"),q=function(t){Object(c["a"])(a,t);var e=Object(u["a"])(a);function a(){var t;return Object(l["a"])(this,a),t=e.apply(this,arguments),t.detail={},t.data=[],t.tabs=[{id:0,name:"TỔNG HỢP LỖI",active:!0},{id:1,name:"HSYCBH"},{id:2,name:"PHI_PHAT_SINH"},{id:3,name:"HD_MOI"},{id:4,name:"HD_HUY"},{id:5,name:"HD_TAI_TUC"},{id:6,name:"HO_SO_PENDING"},{id:7,name:"HO_SO_TU_CHOI"},{id:8,name:"HD_MAT_HIEU_LUC"},{id:9,name:"DS_NHAC_THU_PHI_TAI_TUC"}],t.errorRow=[],t.dataError=[],t.totalErrorCount=0,t.sheetAactive="HSYCBH",t.listSheetFail=[],t.isLoading=!1,t.isLoadingPopup=!1,t.query={page:1,limit:20,total:0},t}return Object(o["a"])(a,[{key:"getIndex",get:function(){return this.query.limit*(this.query.page-1)+1}},{key:"fileName",get:function(){return this.detailFile&&this.detailFile.fileName?this.detailFile.fileName.replaceAll(".xlsx"," "):""}},{key:"errorCount",get:function(){var t=this,e=Object(x["filter"])(this.errorRow,(function(e){return e.sheetName===t.sheetAactive}));return e.length?e[0].errorCount:!e.length&&this.sheetAactive?0:this.totalErrorCount}},{key:"handleOpen",value:function(){var t=this;this.isError?this.getSheetsName().then((function(){t.init()})):this.isError?this.tabs[0].active=!1:(this.tabs.shift(),this.tabs[0].active=!0,this.init())}},{key:"getSheetsName",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={fileId:this.detailFile.id},t.next=3,E.getSheetsName(this.districtId,e).then((function(t){a.errorRow=t.data.data,a.tabs[0].active=!0,a.tabs[0].subactive=!0,a.tabs[1].active=!1,a.sheetAactive=null,Object(x["forEach"])(a.tabs,(function(e){Object(x["forEach"])(t.data.data,(function(t){e.name===t.sheetName&&(e.subactive=!0)}))}))}));case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"checkActiveTab",value:function(t){for(var e=this,a=function(a){if(Object(x["filter"])(t,(function(t){return t.sheetName===e.tabs[a].name})).length)return{v:a}},i=0;i<this.tabs.length;i++){var s=a(i);if("break"===s)break;if("object"===y(s))return s.v}}},{key:"init",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e?this.isLoading=!0:this.isLoadingPopup=!0;var a=Object(n["a"])(Object(n["a"])({},this.query),{},{total:null,fileId:this.detailFile.id,sheetName:this.sheetAactive});E.getDetail(this.districtId,this.isError,a).then((function(a){t.isError?(t.dataError=a.list,t.totalErrorCount=a.total,t.query.total=t.errorCount):(t.detail=a.total,t.data=a.list,t.query.total=a.total.numOfRow),e?t.isLoading=!1:t.isLoadingPopup=!1})).catch((function(a){e?t.isLoading=!1:t.isLoadingPopup=!1,console.log("error",a)}))}},{key:"resetQuery",value:function(){this.query={page:1,limit:20,total:0}}},{key:"handleClose",value:function(){this.isError||this.tabs.unshift({id:0,name:"Tổng hợp lỗi",active:!0}),this.data=[],this.detail={},this.dataError=[],this.errorRow=[],this.resetQuery(),this.sheetAactive="HSYCBH",Object(x["forEach"])(this.tabs,(function(t){1===t.id?t.active=!0:(delete t.active,delete t.subactive)})),console.log("close test popup")}},{key:"handleChangeTab",value:function(t){this.isError&&0===t.id?this.sheetAactive=null:this.sheetAactive=t.name,Object(x["forEach"])(this.tabs,(function(e){e.active=e.id===t.id})),this.$forceUpdate(),this.resetQuery(),this.init(!0)}},{key:"handleSizeChange",value:function(t){this.query.limit=t,this.init(!0)}},{key:"handleCurrentChange",value:function(t){this.query.page=t,this.init(!0)}}]),a}(Object(f["b"])(b["a"],p["a"]));Object(d["a"])([Object(f["c"])({required:!1,type:Object,default:{}})],q.prototype,"detailFile",void 0),Object(d["a"])([Object(f["c"])({required:!1,type:Boolean,default:!1})],q.prototype,"isError",void 0),q=Object(d["a"])([Object(f["a"])({components:{BaseTable:S["a"],BaseIcon:O["a"],HdTable:w["a"],HsTable:I["a"],PendingTable:k["a"],RejectTable:j["a"],InactiveTable:H["a"],ReminderTable:L["a"],IncurredTable:N["a"],TaiTucTable:T["a"]}})],q);var A=q,F=A,z=(a("8274"),a("2877")),D=Object(z["a"])(F,g,C,!1,null,"83effd78",null),U=D.exports,P=Object(v["a"])("import"),R=Object(m["a"])("beUser"),B=function(t){Object(c["a"])(a,t);var e=Object(u["a"])(a);function a(){var t;return Object(l["a"])(this,a),t=e.apply(this,arguments),t.data=[],t.isLoadingButton=!1,t.query={page:1,limit:20,total:0},t.filter={search:"",fd:"",td:"",status:"",userIds:""},t.detailFile={},t.isError=!1,t.isLoading=!1,t.isSpace=!1,t.fileAccept=h["a"],t.fileName="",t.params={type:"BH"},t.handleSearch=Object(x["debounce"])((function(e){t.resetQuery(),t.isLoading||(t.filter.search=Object(x["trim"])(e),t.init())}),500),t}return Object(o["a"])(a,[{key:"mounted",value:function(){this.init()}},{key:"created",value:function(){var t,e;this.apiImport=Object(v["a"])("import",{districtId:null===(t=this.user)||void 0===t||null===(e=t.districts)||void 0===e?void 0:e[0].id})}},{key:"getIndex",get:function(){return this.query.limit*(this.query.page-1)+1}},{key:"init",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.isLoading=!0,e=Object(n["a"])(Object(n["a"])({},this.query),{},{search:this.filter.search?this.filter.search:null,fd:this.filter.fd?this.filter.fd:null,td:this.filter.td?this.filter.td:null,status:this.filter.status?this.filter.status:null,userIds:this.filter.userIds?this.filter.userIds:null,total:null,type:"BH"}),t.next=4,P.getData(this.districtId,e);case 4:a=t.sent,this.data=a.files,this.query.total=a.total,this.isLoading=!1;case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"handleFilterDate",value:function(t){this.resetQuery(),this.filter.fd=t.fd,this.filter.td=t.td,this.init()}},{key:"handleFilterStatus",value:function(t){this.resetQuery(),this.filter.status=t.join(","),this.init()}},{key:"handleFilterUser",value:function(t){this.resetQuery(),this.filter.userIds=t.join(","),this.init()}},{key:"handleSizeChange",value:function(t){this.query.limit=t,this.init()}},{key:"handleCurrentChange",value:function(t){this.query.page=t,this.init()}},{key:"handleGetDetail",value:function(t){console.log("aaa",t),this.detailFile=t.row,this.isError="FAIL"===t.row.status,"IN_PROGRESS"!==t.row.status&&"NEW"!==t.row.status&&"SUCCESS"!==t.row.status?this.setOpenPopup({popupName:"detail-file",isOpen:!0}):this.$message.error("File đang xử lý, vui lòng đợi")}},{key:"handleChangeFile",value:function(t){this.uploadFile(t)}},{key:"resetQuery",value:function(){this.query.page=1,this.query.limit=20}},{key:"handleOpenExportFile",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a,i=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.isLoadingButton=!0,t.next=3,null===(e=this.apiImport)||void 0===e?void 0:e.spamleFile(this.districtId,this.params).then((function(t){a=t.data;var e=document.createElement("a");e.style.display="none",e.href=a,document.body.appendChild(e),e.click(),document.body.removeChild(e),i.isLoadingButton=!1,i.isLoadingButton=!1})).catch((function(t){console.log(t),i.isLoadingButton=!1}));case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"uploadFile",value:function(t){var e=this,a=this.$message({message:"Đang tải file lên",type:"success",duration:0});this.$message.close();var i=new FormData;"ready"===t.status&&(i.append("file",t.raw),i.append("name",t.name),i.append("type","BH"),P.uploadFile(this.districtId,i).then((function(){a.close(),e.$message.success("Tải lên thành công"),e.init()})).catch((function(t){a.close(),429===t.errorCode?e.$message.error("Không upload được file khi hệ thống đang cập nhật dữ liệu. Vui lòng thử lại sau ít phút"):e.$message.error("Tải lên thất bại")}))),this.isSpace=!1}},{key:"hasWhiteSpace",value:function(t){t.indexOf(" ")>=0&&(this.isSpace=!0)}}]),a}(Object(f["b"])(b["a"],p["a"]));Object(d["a"])([R.State("user")],B.prototype,"user",void 0),B=Object(d["a"])([Object(f["a"])({components:{ImportFilter:_["a"],ImportFileDetail:U}})],B);var G=B,$=G,Q=(a("c37e"),Object(z["a"])($,i,s,!1,null,"091c5502",null));e["default"]=Q.exports},c37e:function(t,e,a){"use strict";a("0b8e")}}]);
//# sourceMappingURL=chunk-fcb9c14e.ed84b97c.js.map